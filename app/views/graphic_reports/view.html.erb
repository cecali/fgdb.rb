<%= render :partial => 'in_dev' %>

<center>
<h1><%= @title %></h1>

<%# generate teh graph %>
<% tempfile = Tempfile.new("graph", File.join(RAILS_ROOT, "tmp", "tmp")).path %>
<% basename = File.basename(tempfile).sub(".", "$") %>
<%
  Gnuplot.open do |gp|
    Gnuplot::Plot.new( gp ) do |plot|
      plot.set "terminal", "jpeg"
      plot.set "output", tempfile
      plot.notitle
      plot.ylabel ""
      plot.xlabel ""
      @data.each do |k,v|
        plot.data << Gnuplot::DataSet.new( [@graph_x_axis, v] ) do |ds|
          ds.with = "linespoints"
          ds.title = k.to_s.titleize
        end
      end
    end
  end
  %>
<img src="<%= url_for :action => "get_temp_file", :id => basename %>" />
<%# generate teh table %>
<table style="border-collapse: collapse;" border="1" width="100%">
  <tr>
    <th />
    <% @data.each do |k,v| %>
        <th><%= k.to_s.titleize %></th>
    <% end %>
  </tr>
  <% @x_axis.each_with_index do |x,i| %>
    <tr>
      <th><%= x %></th>
      <% @data.each do |k,v|%>
        <td><%= v[i] %></td>
      <% end %>
    </tr>
  <% end %>
</table>
</center>

