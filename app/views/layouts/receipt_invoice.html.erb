<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<head>
  <title class="banner"><%= @context %></title>
  <%= stylesheet_link_tag 'application', :media => 'all' %>
  <%= javascript_include_tag :defaults %>
</head>
<body>
  <table  width="75%">
    <tr>
      <td colspan="3"><%= render :partial=>"helpers/letter_head",
                          :locals=> {:contact_information => @txn.contact_information, :hidable_contact_information => @transaction.hidable_contact_information, :hideit => @transaction.should_i_hide_it?}%></td>
    </tr>
    <tr>
      <td colspan="3"><hr /></td>
    </tr>

    <tr>
      <td colspan="2">
        <%= @context.titleize %>
        <strong>
          <% if @txn.invoiced? %>
            <font color="#FF0000" size="+2"><%= @txn.invoice_resolved_at.nil? ? "" : "Paid " %>Invoice</font>
          <% else %>
            Receipt
          <% end %>
        </strong>
      </td>
      <% if @context == 'donation' %>
        <td align="right"><%= h Default['tax id'] %></td>
      <% else %>
        <td align="right"><%= h Default['business id'] %></td>
      <% end %>
    </tr>
    <tr>
      <td colspan="3">Created by #<%=h User.find_by_id(@transaction.cashier_created_by).contact_id %></td>
    </tr>
    <tr>
      <td>Date: <%= @txn.occurred_at.strftime("%m/%d/%Y") %></td>
      <td align="center">
        <%= @context.titleize %> <strong><%= "# " + @txn.id.to_s %></strong>
      </td>
      <td align="right">
        <% if @txn.invoiced? %>
          <strong>
            Due: <%= @transaction.created_at.+(60*60*24*30).strftime("%m/%d/%Y") %>
          </strong>
        <% end %>
      </td>
    </tr>

    <%= yield %>

    <p>
      <div id="button_span" class="noprint">
        <INPUT type="button" id="print_button" value="Print"
               onclick="window.print(); window.close();" >

        <INPUT type="button" id="restart_button" value="Start Over"
               onclick="window.close()" >

        <% if params[:controller] == 'sales' %>
        <hr />
        <%= receipt_printer_html %>
        <% elsif params[:controller] == 'donations' %>
          <hr />
          <%= button_to "View PDF", {:action => "pdf", :id => params[:id], :gizmo_context_id => params[:gizmo_context_id]} %><br />
          <% if defined?(@message) %>
            <span class="<%= @is_err ? "error" : "" %>">
              <b><%= @message %></b>
            </span>
          <% end %>
          <% form_tag({:action => "mail_pdf", :id => params[:id], :gizmo_context_id => params[:gizmo_context_id]}) do %>
            <% if @txn.contact_id %>
              Choose an e-mail address to send to:</br >
              <% @txn.contact.contact_methods.select{|x| x.contact_method_type.name.match(/email/)}.each do |x| %>
                <div class='form-element'>
                  <%= radio_button_tag('address_choice', "contact_method_#{x.id}", false) %><%= x.contact_method_type.description %><%= x.ok ? "" : " (not usable)" %>: <%= h x.value %><br />
                </div>
              <% end %>
            <div class='form-element'>
              <%= radio_button_tag('address_choice', 'other', true) %>
            <% else %>
              <div class='form-element'>
                <%= hidden_field_tag('address_choice', 'other') %>
            <% end %><label for="address">Enter an e-mail address: </label><%= text_field_tag 'address' %>
            <% if @txn.contact_id %>
              <label for="save">Save to contact record?</label> <%= check_box_tag "save" %>
              <%= observe_field("save",
                                :function => "{var x = $('contact_method_type_id'); if ($('save').checked) { x.show() } else { x.hide() }}"
                                ) %>
              <%= select_tag "contact_method_type_id", options_from_collection_for_select(ContactMethodType.find(:all).select{|x| x.name.match(/email/)}.sort_by(&:name), "id", "description"), :style => 'display: none' %>
            <% end %>
            </div>
            <br />
            <div class='form-element' style="clear:left">
              <%= submit_tag "Send PDF" %>
            </div>
          <% end %>
        <% end %>
      </div>
    </p>
</body>
</html>
