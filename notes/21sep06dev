
#===========================================================
### roadmap for 21 sep

TODO
----

. remove column 'user_id' from contacts table and regenerate or
adjust appropriate files
  . drop via database prompt, then dump and reload to maximize
    integrity of everything

. build up [scaffold_columns] in contacts helper

DONE
----

. resolve checkbox/dropdown possible conflict in contacts
_form.rhtml
  . remove dropdown logic, move checkbox logic to top - fixed!

. add method 'find_all_except' to ActiveRecord::Base
  . returns all recs in table but for those in list of records
  passed as arg
  . created lib/model_modifications.rb to hold first project
  change to ActiveRecord framework
  . added require 'model_modifications' to config/environment.rb

. change list display characteristics for most other tables
  . Example for "relationships" table (incl. source and sink
  attrib logic unique to this table)

Index: app/helpers/relationships_helper.rb
===================================================================
--- app/helpers/relationships_helper.rb	(revision 114)
+++ app/helpers/relationships_helper.rb	(working copy)
@@ -6,7 +6,18 @@
   end
   
   def scaffold_columns
-    Relationship.scaffold_columns
+     [ AjaxScaffold::ScaffoldColumn.new(Relationship, 
+        :name => 'source', :label => 'Source', 
+        :eval => 'relationship.source', :sortable => false),
+      AjaxScaffold::ScaffoldColumn.new(Relationship, 
+        :name => 'type', :label => 'Type', 
+        :eval => 'relationship.relationship_type', :sortable => false),
+      AjaxScaffold::ScaffoldColumn.new(Relationship, 
+        :name => 'sink', :label => 'Sink', 
+        :eval => 'relationship.sink', :sortable => false),
+      AjaxScaffold::ScaffoldColumn.new(Relationship, 
+        :name => 'flow?'),
+      ]
   end

Index: app/views/relationships/_form.rhtml
===================================================================
--- app/views/relationships/_form.rhtml	(revision 114)
+++ app/views/relationships/_form.rhtml	(working copy)
@@ -2,17 +2,31 @@
 <div class="form-element">
-  <label for="relationship_flow">Flow</label>
-  <%= text_field 'relationship', 'flow' , {:class=>"text-input"} %>
+<label for="relationship_source_id">Source</label><br/>
+<select id="relationship_source_id" name="relationship[source_id]">
+  <%= options_from_collection_for_select Contact.find_all, "id", "display_name", @relationship.source_id %>
+</select>
 </div>
 
 <div class="form-element">
-<label for="relationship_type_id">Relationship type</label><br/>
+<label for="relationship_relationship_type_id">Relationship type</label><br/>
 <select id="relationship_relationship_type_id" name="relationship[relationship_type_id]">
   <%= options_from_collection_for_select RelationshipType.find_all, "id", "description", @relationship.relationship_type_id %>
 </select>
 </div>
 
+<div class="form-element">
+<label for="relationship_sink_id">Sink</label><br/>
+<select id="relationship_sink_id" name="relationship[sink_id]">
+  <%= options_from_collection_for_select Contact.find_all, "id", "display_name", @relationship.sink_id %>
+</select>
+</div>
+
+<div class="form-element">
+  <label for="relationship_flow">Flow</label>
+  <%= text_field 'relationship', 'flow' , {:class=>"text-input"} %>
+</div>
+
 
. change default scaffold_columns in contact_method_types
  . see revision 114
  . see above example for relationships

. add code for treelike use of parent_id in contact_method_types
  . see revision 114

Index: app/helpers/contact_method_types_helper.rb
===================================================================
   def scaffold_columns
-    ContactMethodType.scaffold_columns
+     [ AjaxScaffold::ScaffoldColumn.new(ContactMethodType, 
+        :name => 'parent_id', :label => 'Parent Type', 
+        :eval => 'contact_method_type.parent.description', :sortable => false),
+      AjaxScaffold::ScaffoldColumn.new(ContactMethodType, 
+        :name => 'description'),
+      ]
   end

Index: app/views/contact_method_types/_form.rhtml
 <div class="form-element">
+  <label for="contact_method_type_parent">Parent Type</label>
+  <select id="contact_method_type_parent" name="contact_method_type[parent_id]">
+    <%= options_from_collection_for_select ContactMethodType.find_all_except(@contact_method_type), "id", "description", @contact_method_type.parent_id %>
+  </select>
 </div>

